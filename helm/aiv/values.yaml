# Global settings
fullnameOverride: "aiv"
nameOverride: ""

replicaCount: 1

# Image configuration
image:
  repository: ""  # Set your image repository
  tag: ""  # Overrides the image tag (default is chart appVersion)
  pullPolicy: IfNotPresent

imagePullSecrets: []

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod annotations
podAnnotations: {}

# Pod security context
podSecurityContext: {}

# Container security context
securityContext: {}

# Resource limits and requests
resources: {}

# Liveness probe configuration
livenessProbe: {}

# Readiness probe configuration
readinessProbe: {}

# Custom command
command: []

# Autoscaling configuration
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}

# Custom environment variables
envs: {}

# Environment variables from secret
env: {}

# PostgreSQL Configuration
# Configure connection to external PostgreSQL database
postgresql:
  # -- Enable PostgreSQL connection
  enabled: true
  # -- PostgreSQL server hostname
  host: postgresql
  # -- PostgreSQL server port
  port: 5432
  # -- PostgreSQL database name
  database: aivdb
  # -- PostgreSQL username
  username: dbadmin
  # -- PostgreSQL password
  password: "pasAswordA12"

  # Additional datasource for security schema
  datasource1:
    # -- Enable second datasource for security schema
    enabled: true
    # -- Schema name for datasource1
    schema: security

  # JNDI datasource configuration
  jndi:
    # -- Enable JNDI datasource
    enabled: true
    # -- JNDI name
    name: jdbc/ActiveIDB

# Kafka Configuration
# Optional - disabled by default (for single node mode)
# Enable for AIV cluster mode (multi node)
kafka:
  # -- Enable Kafka (required for cluster mode)
  enabled: false
  # -- Kafka bootstrap servers
  bootstrapServers: kafka:9092
  # -- Kafka username (if SASL auth is enabled)
  username: ""
  # -- Kafka password (if SASL auth is enabled)
  password: ""
  # -- SASL mechanism (e.g., PLAIN, SCRAM-SHA-256)
  saslMechanism: ""
  consumer:
    # -- Kafka consumer group ID
    groupId: task-consumer-group
    # -- Auto offset reset strategy
    autoOffsetReset: earliest
  producer:
    # -- Kafka producer key serializer
    keySerializer: org.apache.kafka.common.serialization.StringSerializer
    # -- Kafka producer value serializer
    valueSerializer: com.aiv.cluster.MapSerializer

# Application Configuration
application:
  server:
    # -- Application server port
    port: 80
    # -- Application context path
    contextPath: /aiv
    compression:
      # -- Enable response compression
      enabled: true

  storage:
    # -- Image storage location
    imgLocation: /opt/repository/images/
    # -- Application files location
    appLocation: /opt/repository/APP/
    # -- Repository root location
    repositoryLocation: /opt/repository
    # -- Log directory
    logDir: /opt/logs
    # -- Delivery files location
    deliveryLocation: /opt/repository/delivery

  security:
    # -- Security implementation class
    securityClass: com.security.services.SimpleAuthImpl
    # -- Enable Jira authentication
    isJira: false

  # Application security keys
  # Leave empty to auto-generate secure random values
  secrets:
    # -- Encryption key for stoken decryption (auto-generated if empty)
    slatKey: ""
    # -- IV spec key for stoken (auto-generated if empty)
    ivspec: ""
    # -- Internal token for microservices auth (auto-generated if empty)
    internalToken: ""
    # -- Embed encryption key (auto-generated if empty)
    embedEkey: ""
    # -- Embed token key (auto-generated if empty)
    embedTokenKey: ""

  task:
    manager:
      # -- Task manager mode: single (no Kafka) or multi (requires Kafka)
      mode: single
    kafka:
      # -- Kafka topic retention in milliseconds
      retentionMs: 60000
      topic:
        # -- Kafka topic name
        name: task-topic
        # -- Number of partitions
        partitions: 2
        # -- Replication factor
        replicationFactor: 1

  embed:
    # -- Use custom token for embed
    iscustomtoken: false

  liquibase:
    aiv:
      # -- Enable Liquibase for AIV schema
      enabled: true
      # -- Liquibase changelog file for AIV
      changeLog: classpath:db/changelog/db.changelog-aiv.sql
    security:
      # -- Enable Liquibase for security schema
      enabled: true
      # -- Liquibase changelog file for security
      changeLog: classpath:db/changelog/db.changelog-security.sql

# Service configuration
service:
  type: LoadBalancer
  port: 80
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-internal: "false"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "tcp"
    # service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:ap-southeast-1:417447013272:certificate/your-certificate-id"
    # service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

# Volume mounts configuration
volumeMounts:
- mountPath: /opt/repository/econfig/application.yml
  subPath: application.yml
  name: files
- mountPath: /opt/repository/econfig/logback.xml
  subPath: logback.xml
  name: files

# Configuration files
# Note: application.yml will be templated in configmap.yaml
# logback.xml is kept as-is
files:
  logback.xml: |
    <?xml version="1.0" encoding="UTF-8"?>
    <configuration>
      <springProperty scope="context" name="jsonlogs" source="app.logs.jsonlogs"/>
      <springProperty scope="context" name="showdept" source="app.logs.showdept"/>
      <springProperty scope="context" name="showtraceid" source="app.logs.showtraceid"/>
      <logger name="core" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <logger name="db" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <logger name="data" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <logger name="birt" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <logger name="rest" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <logger name="jasper" level="INFO" additivity="false">
        <appender-ref ref="CONSOLE"/>
      </logger>
      <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
          <layout class="ch.qos.logback.classic.PatternLayout">
              <Pattern>%d %p %c{1} [%t] %m%n</Pattern>
          </layout>
      </appender>
      <root level="INFO">
        <appender-ref ref="CONSOLE"/>
      </root>

    </configuration>

# Persistence configuration
persistence:
  enabled: false
  storageClassName: gp3
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  annotations: {}
  storageClass:
    create: true
    name: gp3
    provisioner: ebs.csi.aws.com
    parameters:
      type: gp3
      fsType: ext4
    volumeBindingMode: WaitForFirstConsumer
    allowVolumeExpansion: true
    annotations:
      storageclass.kubernetes.io/is-default-class: "true"

# Driver updater configuration
driver_updater:
  enabled: false
  securityContext: null

# Base64 encoded files (for secrets)
base64_files: {}

# AI deployment configuration (optional additional deployment)
ai:
  enabled: false
  replicaCount: 1
  image:
    repository: ""
    tag: ""
    pullPolicy: IfNotPresent
  containerPort: 8080
  env: {}
  persistence:
    enabled: false
